{% extends 'dashboard_crud/base_list.html' %}

{% load static %}
{% load i18n %}
{% load dashboard_filters %}

{% block vendor_css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'vendor/libs/datatables-bs5/datatables.bootstrap5.css' %}">
{% endblock vendor_css %}

{% block table_headers %}
<th>Date</th>
<th>Amount</th>
<th>Target</th>
<th>Progress</th>
{% endblock %}

{% block table_body %}
{% for sale in sales_data %}
<tr>
  <td>{{ sale.date }}</td>
  <td>${{ sale.amount }}</td>
  <td>${{ sale.target }}</td>  <td>
    <div class="d-flex align-items-center">
      <div class="progress w-100 me-3" style="height: 6px;">
        <div class="progress-bar bg-primary" 
             style="width: {{ sale.get_percentage|floatformat:1 }}%" 
             role="progressbar" 
             aria-valuenow="{{ sale.get_percentage|floatformat:1 }}" 
             aria-valuemin="0" 
             aria-valuemax="100">
        </div>
      </div>
      <span class="text-muted">{{ sale.get_percentage|floatformat:1 }}%</span>
    </div>
  </td>
  <td>
    <div class="dropdown">
      <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
        <i class="ri-more-2-fill"></i>
      </button>
      <div class="dropdown-menu">
        <a class="dropdown-item" href="{% url 'dashboards:sales_update' sale.id %}">
          <i class="ri-pencil-line me-1"></i> Edit
        </a>
        <a class="dropdown-item text-danger" href="{% url 'dashboards:sales_delete' sale.id %}">
          <i class="ri-delete-bin-line me-1"></i> Delete
        </a>
      </div>
    </div>
  </td>
</tr>
{% empty %}
<tr>
  <td colspan="5" class="text-center">No sales data available</td>
</tr>
{% endfor %}
{% endblock %}

{% block page_js %}
{{ block.super }}
<script src="{% static 'vendor/libs/datatables-bs5/datatables.bootstrap5.js' %}"></script>
<script>
  $(document).ready(function() {
    $('table').DataTable({
      "pageLength": 10,
      "ordering": true,
      "order": [[0, 'desc']],
      "info": true,
      "lengthChange": true,
      "searching": true,
    });
  });
</script>
{% endblock %}
